<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <title>Ever dream this man?</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
</head>
<body>
    <div class="container text-center mt-5">
        <img src="thisMan.svg" width="80%" alt="This Man">
        <h3>Share this image, please</h3>
        <h6>Pe piacer fra</h6>
        <h4>delta1 ci sta sognando</h4>
        <a href="thisMan.pdf" class="btn btn-primary mt-3">Download file</a>

        <div id="timer" class="mt-4 display-4 text-danger"></div>

        <button class="btn btn-success mt-3" onclick="aggiungiDataOra()">Aggiungi Data, Ora e IP</button>
    </div>

    <script>
        function getNextMondayAtNinePM() {
            const now = new Date();
            let nextMonday = new Date(now);
            nextMonday.setDate(now.getDate() + ((1 + 7 - now.getDay()) % 7 || 7));

            if (now.getDay() === 1 && now.getHours() >= 21) {
                nextMonday.setDate(nextMonday.getDate() + 7);
            }

            nextMonday.setHours(21, 0, 0, 0);
            return nextMonday;
        }

        function updateTimer() {
            const now = new Date();
            const target = getNextMondayAtNinePM();
            const diff = target - now;

            if (diff <= 0) {
                document.getElementById('timer').innerHTML = "Timer scaduto!";
                return;
            }

            const days = Math.floor(diff / (1000 * 60 * 60 * 24));
            const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((diff % (1000 * 60)) / 1000);

            document.getElementById('timer').innerHTML = 
                `${days}d ${hours}h ${minutes}m ${seconds}s`;
        }

        function aggiungiDataOra() {
            fetch("https://api64.ipify.org?format=json")  // Ottiene l'IP pubblico
                .then(response => response.json())
                .then(data => {
                    const ip = data.ip;
                    fetch("URL_DEL_WEB_APP?ip=" + ip, { method: "GET", mode: "no-cors" })
                        .then(() => alert("Data, ora e IP aggiunti con successo!"))
                        .catch(() => alert("Errore nell'aggiungere la data e ora."));
                })
                .catch(() => alert("Errore nel recupero dell'IP"));
        }

        setInterval(updateTimer, 1000);
        updateTimer();
    </script>
</body>
</html>
